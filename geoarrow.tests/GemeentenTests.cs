using Apache.Arrow.Ipc;
using NetTopologySuite.IO;

namespace geoarrow.tests;
public class GemeentenTests
{
    [Test]
    public async Task TestGemeenten()
    {
        var file = "testfixtures/gemeenten2016.arrow";
        var fileStream = File.OpenRead(file);
        var compression = new CompressionCodecFactory();
        var reader = new ArrowFileReader(fileStream, compression);
        var recordBatch = await reader.ReadNextRecordBatchAsync();

        // column 35 contains the geometries
        var geometryArray = recordBatch.Column(35);

        // convert to WKB
        var polygons = geometryArray.ToWkb();

        // should be 391... some multipolys
        Assert.That(polygons.Count() == 808);

        // get the first polygon
        var firstPolygon = polygons.First();
        var wkbreader = new WKBReader();
        var wkb = wkbreader.Read(firstPolygon);
        // convert to WKT
        var wktWriter = new WKTWriter();
        var wkt = wktWriter.Write(wkb);

        //  Assert.That(wkt == "POLYGON ((6.831992233164796 53.32728810108807, 6.834456953490564 53.32711512373632, 6.834351787555417 53.32792345822937, 6.83579956167025 53.32908600085572, 6.836996499854077 53.32937122533216, 6.838148446589035 53.32942548938834, 6.838925309684895 53.33053287078785, 6.837539776105846 53.331817920971396, 6.836673078099735 53.3320123635533, 6.837030763153134 53.33248173689741, 6.836771761912201 53.33337640941728, 6.836167165339337 53.3337899320607, 6.83619146133304 53.33422701975894, 6.835437527002471 53.3345329368625, 6.834586964681894 53.33465008329826, 6.834834899847289 53.33552053832218, 6.834305608010714 53.335887591402845, 6.834276620114871 53.33648426468824, 6.833731747053061 53.336813004533724, 6.834297963969995 53.33769018027013, 6.833986852862723 53.33892685783852, 6.834532808644014 53.34005616603736, 6.83397207187408 53.340405200406686, 6.833450426258444 53.34130329181547, 6.833426110648743 53.341796293425055, 6.833158935034588 53.3418476378578, 6.83466662077976 53.343163643333455, 6.834298897814775 53.343308150427234, 6.835504303793301 53.34395112136494, 6.836107346207244 53.3439609480772, 6.836206586996937 53.34441786295861, 6.835724744340872 53.34473814982698, 6.836150842760729 53.34513091728453, 6.838268276469357 53.34469268018884, 6.839038580384219 53.3450680377767, 6.8390678024793 53.345630074596244, 6.840414733936187 53.34498046542369, 6.840726726617702 53.345323607348305, 6.841738472758458 53.34554147996793, 6.843783679526222 53.34431773090567, 6.844526909675203 53.34350806710757, 6.847987377449996 53.344532580335, 6.848840926193702 53.344618569121494, 6.849096841180991 53.34480571064501, 6.849804543722822 53.34472204930836, 6.850344009399237 53.34482698977116, 6.851365871213821 53.34436562269247, 6.85240328927441 53.3443532734197, 6.853731606449978 53.343980648619514, 6.854719517274096 53.3438875462297, 6.856169820300866 53.3440531965184, 6.857313525333924 53.3437459442177, 6.860717518915633 53.34328551475935, 6.861064672512574 53.3441018253205, 6.86336651591269 53.34355676531897, 6.862747000747606 53.34254788876039, 6.866797518057571 53.34180561156985, 6.867168732175504 53.34339461166878, 6.86950909787801 53.34275047518323, 6.871726535272991 53.3426808899276, 6.871786005507783 53.34294416142012, 6.873802561883215 53.34294887406136, 6.873915686413651 53.34336622877736, 6.874576035036233 53.34396988223328, 6.875540227259146 53.345440097197375, 6.874662897866142 53.34564855810812, 6.874369993379755 53.3460412882109, 6.8754293232825 53.34735043879448, 6.880242286188039 53.34638800624131, 6.885405185784171 53.34512804025874, 6.885504665417984 53.34139727871528, 6.884315712808463 53.34100115285624, 6.883404844792857 53.33984938061938, 6.883716984071758 53.3390065117713, 6.883138719871889 53.338855643928426, 6.882550668761183 53.338041354898664, 6.883528203324345 53.33655918110438, 6.882953796240201 53.33574322311011, 6.883061966161152 53.33388248566646, 6.882421321341296 53.329942512160834, 6.882558343000662 53.32954494918648, 6.881731093946281 53.32854200933709, 6.882093881628831 53.32754005091399, 6.881971280417392 53.32482494889413, 6.883446737182189 53.323743656723565, 6.883006187975838 53.316410479458284, 6.885622703095953 53.30913441627067, 6.888160844997756 53.30965500549787, 6.887377120106532 53.29788201699729, 6.887169869070115 53.29832993078135, 6.886964224843235 53.29835233187659, 6.88481758044519 53.297593179022755, 6.884087445692241 53.29762797105249, 6.883706631446032 53.29746589548142, 6.882313152452672 53.29786923979656, 6.880651641870585 53.29765220705978, 6.880114653044777 53.29788947912641, 6.879609005154566 53.29784966835135, 6.87951337689221 53.29664509678347, 6.877102074530744 53.296557208815564, 6.874566739617048 53.29561146715308, 6.873716578485901 53.29565289472219, 6.873222396621798 53.29649377010052, 6.860723255239939 53.29498698903118, 6.860324827859261 53.294998004084064, 6.860254505430072 53.29632574329477, 6.856243383097325 53.296788502500966, 6.851902098068509 53.29668193132654, 6.851157879877341 53.29703818205577, 6.849973760317623 53.294936372708314, 6.845805646766756 53.290126006118136, 6.838278461181072 53.29034818916333, 6.837920831963777 53.29046874157471, 6.828072514393713 53.29109183817083, 6.825161691353493 53.29762230558948, 6.818299322084859 53.29601236074354, 6.817632956118258 53.29555719175269, 6.816649353434034 53.29518208990336, 6.807369372715842 53.30479174596815, 6.809360786881094 53.30546833300666, 6.810021434470653 53.30550229912515, 6.810684227892929 53.306028338674246, 6.811603755682733 53.30621873984805, 6.808352733743532 53.310433353724065, 6.807608599306129 53.3101265457279, 6.80652864683942 53.3110810907173, 6.808056273002172 53.31171339143601, 6.803338104284021 53.31592011915387, 6.805088160842589 53.31680046944686, 6.806084716987785 53.31708166782677, 6.804295062902415 53.32041995777506, 6.806603749376356 53.32145869064009, 6.8044830374332 53.3239266843026, 6.805818426010741 53.323835894389845, 6.806825974536318 53.324008310557666, 6.807663213877801 53.324992321820716, 6.807360820136115 53.32595016652186, 6.810476670387598 53.32649311906245, 6.810730624771138 53.32637445618109, 6.810405674043366 53.326193273189794, 6.810482844874384 53.32581672563657, 6.81021245051651 53.32554206531207, 6.810632281601666 53.325206033517325, 6.81304442402552 53.32533075355975, 6.813198685157519 53.32483071393138, 6.813459251247241 53.324727737927496, 6.813283969354798 53.32540752297092, 6.814344351273638 53.325705168331346, 6.815154908479114 53.32574974816036, 6.815559039452 53.32596535798729, 6.815322776558497 53.32676220040568, 6.815848404402773 53.326828196575875, 6.81799962998377 53.326637150340765, 6.818841533727438 53.32672003769056, 6.819406414974557 53.32699681351866, 6.819900656141912 53.326969985115255, 6.820655832767897 53.32724125189188, 6.823464386752614 53.327645628851684, 6.823694046172074 53.328135793071695, 6.824822450965866 53.32819104933965, 6.826209758434188 53.32778677343059, 6.828104763489646 53.32770314439903, 6.828032265631103 53.3274204899484, 6.831865446197932 53.327387063415856, 6.831992233164796 53.32728810108807, 6.831992233164796 53.32728810108807))");
    }

}
